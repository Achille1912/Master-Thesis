\appendix

\chapter{Configurazioni YAML complete}
\begin{code}{yaml}
    TRAINING:
  workspace: /home/cannavale/data/seg_breast/exp_24/                                                     # Workspace dell'eseprimento (cannavale/data/seg_brest/exp1/)
  monai_data: /ssd1/cantone/datasets/Duke-Breast-Cancer-MRI/other/data_monai_relative                  # File di metadati che spiega al framework come funziona il dataset
  dataset_root: /ssd1/cantone/datasets/Duke-Breast-Cancer-MRI/                                        # percorso del dataset
  valid_size: 0.1
  test_size: 0.1                                                                                        # 20% in test e 80% in train
  train_test_split_seed: 42                                                                             # seed della randomicità dello split
  cache_ratio: 0.1                                                                                     # metto basso e metto un accumulation a 4
  accumulation: 4                                                                                      # l'optimizer entra in gioco ogni 4 volte
  train_batch_size: 4                                                                                  
  test_batch_size: 1                                                                                    # (lascia 1)
  num_workers: 8                                                                                 # processi cpu utilizzati (2,4,6,8)
  device: cuda:3                                                                    # scelgo la gpu
  load_model: /home/cannavale/data/seg_breast/exp_22/best_model.pth                                                                                       # non mi interessa
  epochs: 200                                                                                            # inizia con 50/100, poi in base ai risultati ferma quando non migliora più
  sliding_window: True  
  only_test: True                                                                               # se divido l'input in sottovolumi, in training imparo con i sotto-volumi (da fare con i vasi), in test uso l'intera immagine.
  roi_size: 
    - 512
    - 512
    - 8                                                                                       
  
TRAIN_TRANSFORM:
  - class: monai.transforms.LoadImaged                                                                  # carica le immagini
    params:
      keys:
        - post_2
        - breast
  - class: monai.transforms.EnsureChannelFirstd
    params:
      keys:
        - post_2
        - breast
  - class: monai.transforms.ConcatItemsd                                                                # cambia la label dell'immagine in img
    params:
      keys:
        - post_2
      name: img
      dim: 0
  - class: monai.transforms.ConcatItemsd                                                                # cambia la label della groundtruth in seg
    params:
      keys:
        - breast
      name: seg
      dim: 0
  - class: monai.transforms.DeleteItemsd                                                                # cancella tutte le cose che non mi servono
    params:
      keys:
        - pre
        - post_1
        - post_2
        - post_3
        - post_4
        - breast
        - vessels
  - class: monai.transforms.ScaleIntensityd
    params:
      keys:
        - img
      maxv: 1.0
      minv: 0.0
  - class: monai.transforms.Resized
    params:
      keys:
        - img
        - seg
      spatial_size: 
        - 512 
        - 512 
        - 0
      mode:
        - area
        - nearest
  - class: monai.transforms.RandSpatialCropSamplesd
    params:
      keys:
        - img
        - seg
      num_samples: 4
      roi_size: 
        - 512
        - 512
        - 8




TEST_TRANSFORM:
  - class: monai.transforms.LoadImaged                                                                  # carica le immagini
    params:
      keys:
        - post_2
        - breast
  - class: monai.transforms.EnsureChannelFirstd
    params:
      keys:
        - post_2
        - breast
  - class: monai.transforms.ConcatItemsd                                                                # cambia la label dell'immagine in img
    params:
      keys:
        - post_2
      name: img
      dim: 0
  - class: monai.transforms.ConcatItemsd                                                                # cambia la label della groundtruth in seg
    params:
      keys:
        - breast
      name: seg
      dim: 0
  - class: monai.transforms.DeleteItemsd                                                                # cancella tutte le cose che non mi servono
    params:
      keys:
        - pre
        - post_1
        - post_2
        - post_3
        - post_4
        - breast
        - vessels
  - class: monai.transforms.ScaleIntensityd
    params:
      keys:
        - img
      maxv: 1.0
      minv: 0.0
  - class: monai.transforms.Resized
    params:
      keys:
        - img
      spatial_size: 
        - 512 
        - 512 
        - 0
      mode:
        - area



MODEL:
  class: monai.networks.nets.Unet 
  params:
    channels:
      - 16
      - 32
      - 64
      - 128
      - 256
    in_channels: 1
    out_channels: 2
    spatial_dims: 3
    norm: INSTANCE
    strides:  
      - 2 
      - 2
      - 2
      - 1

LOSS:
  class: monai.losses.DiceFocalLoss  # Combina Dice e Focal
  params:
    softmax: true
    to_onehot_y: true
    lambda_dice: 0.7
    lambda_focal: 0.3

LR_SCHEDULER:
  class: monai.handlers.LinearWarmupCosineAnnealingLR
  params:
    warmup_epochs: 5
    max_epochs: 150
    warmup_start_lr: 0.0001
    eta_min: 0.000001

OPTIMIZER:
  class: torch.optim.AdamW
  params:
    lr: 0.001
    weight_decay: 0.0001  

METRIC:
  class: monai.metrics.DiceMetric
  params:
    include_background: false
    reduction: mean

POST_PRED:
  - class: monai.transforms.AsDiscrete
    params:
      argmax: true

  - class: customClosing.MorphologicalClosing
    params:
      dim: 30

  - class: monai.transforms.AsDiscrete
    params:
      to_onehot: 2

POST_LABEL:                                                                               
  - class: monai.transforms.AsDiscrete
    params:
      to_onehot: 2
    
\end{code}

\chapter{Log di training}
Riportare log di nvidia-smi, tempi, ecc.
